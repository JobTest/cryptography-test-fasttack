
КЛЮЧИ ДЛЯ ИСХОДЯЩИХ ЗАПРОСОВ

a) Генерируем приватный ключ VTS_IAPI_OUT_ISS_PRIV (private-out.pem) вместе с самоподписанным сертификатом VTS_IAPI_OUT_ISS_PUB (certificate-out.pem).

[alexandr@al keys_out]$ openssl req -newkey rsa:2048 -sha1 -nodes -keyout private-out.pem -x509 -days 365 -out certificate-out.pem
Generating a 2048 bit RSA private key
..+++
.+++
writing new private key to 'private-out.pem'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:UA
State or Province Name (full name) []:Kiev
Locality Name (eg, city) [Default City]:Kiev
Organization Name (eg, company) [Default Company Ltd]:cts
Organizational Unit Name (eg, section) []:cts
Common Name (eg, your name or your server's hostname) []:cts.com.ua
Email Address []:test@cartsys.com.ua
[alexandr@al keys_out]$



b) Получаем приватный ключ в форме PKCS#1 (privatekey-out.pem) для его последующего импорта в HSM

[alexandr@al keys_out]$ openssl rsa -in private-out.pem -out privatekey-out.pem
writing RSA key



c) Импортировать ключ VTS_IAPI_OUT_ISS_PRIV (privatekey-out.pem) в HSM

[alexandr@al keys_out]$ java -jar ~/mobo-kmu/mobo-kmu.jar iclrpriv --module libopencryptoki.so --wrapper ~/.mobo-hsm-p11w/libpkcs11wrapper.so --tup console -s 3 -n KILLME -a 0 --keyFile privatekey-out.pem
Please enter Token User PIN: 12345678
Key imported


d) Экспортировать ключ VTS_IAPI_OUT_ISS_PRIV из HSM под ключом LMK3. Полученное значение ключа скопировать в файл (например VTS_IAPI_OUT_ISS_PRIV.txt) для последующей загрузки ключа в веб интерфейс FT.

[alexandr@al keys_out]$ java -jar ~/mobo-kmu/mobo-kmu.jar xpriv --module libopencryptoki.so --wrapper ~/.mobo-hsm-p11w/libpkcs11wrapper.so --tup console -s 3 -n KILLME -w LMK3
Please enter Token User PIN:
Key exported:

F5C1796B55E1817D574742B220E2634EFF7992ECBE94CEFF470213300CA5B2AC188D412F751A03CAD99DD082DEBAD3E178794D7A19F89B89E943A831A94C09EFD36023E490005F1D28DF4EAA557D6374672B1899009355A58C8317135718DE08FC566EE100EC7A9366FAB8B229238DFBA73214A677461C93B156688E840F890D3CC1C3C2717BB727181C356D55E1C331DB3AFE34918426A898B2FAD9156B9CE135CA37510A56027E47A91316BA434F2039C2622C2A578773C9D57327EAB60DC22F472E740804D9406B4B3B78E33F77E5D4303EC2CE79551A2B28224555D64C0CFA2D74AE20DBB5F8DD65D659DD7827EC93FA3F96E7D0670F0265FEDD8E90B1E9EE07D44F9B9B2B4398A9435137D4CD35B94A3CCCD1172046354045B584BCBDE33C031FE19D3870412F9428BF9390CA9069652704A2920E80A83B074F0A2767977D7C56F4DBBACCE1A28935F93E552E9476304CB2E07F6720CBA5EFBC5378B230404E08AD97899A3E6B32E2FCD506582C699BEE1B58C5155E165984AC986D17FF7F451C32E92E9B4DDA778B4EF5F7B656DF96D68AFE5A2A7FA6DDFFEF109CBEAA9E9C0B69213431C8C35962EAF468007C233CE7C056A27B894A2F448C0CB3DD5D6333198161C0DA1B372882075EA83CDC22006A0DC11CDF4517F66C9331C86CAD9849DC65422CA6FDFF4A133CE38FACB6AD41949B56738878156DA32EE5795C075B64E4C8BBA382A54FAE03893BD570AD4D0AC1D5E897E5230D74E0872CE7496181E42047EF25D1016769B6A3560DC52728656507191535914E8129CD968258BF4B692BB5435515F5B5AA7D380FB59C41979E8CA3D135865692D741748F14A22B96C32B523B7D9E71C10772C6C55039C05D902DF1904D97C353EAC1E2830AEEF3FF2EE38D4667FF539F100D1DBF8474E424BD2E604A867172179451F707D0C6EBCA5B0551CAD28C8EDC6596BF5D448E6F5B71D6C82F20FEA611930674209952A0F87BB0D15D34677036E2607E831363CD3DAD30DF22EDCAB4B19B091CCDC91291A44EE7D30557126C1D72BC9827E3C3F000727632B9071B25382BBD08C86C795B69516DFBAA2A86EEA8F0AFFA4C4802724AA5D081D2CE1D95CB541FD6E1808639F0F776623FA2A23245D229858D1B854D1B27EBB1F9680AA8C96A1EDCF2009A7D7EF0E7F22E3041AE7EDC0975FA8BE17B9F08398015669CA73A8CFBDC1AE2D143FB64B672833B1066BC33425221DDDEA7E7737F23CC13427076005287F1381D2BC69B71120875C50C07AF55B0CE382CBC4B65F44BAE5DFDF22FC02DCE6955DA56792849F28DF915A2CC9258404DC858913A95640A1AE96853FEDADFD9531134CB749694E949F44E4EA23C4EDBFC16A2B636EFBD44D9E4A8C92129744A470DE002BDA8DDF9CBBE9CFF89C90226C63587FF6197B8AB18C0905808054F429D2069A25FBEBEEBCA88ED03299BC12B73DD2300A349B93D13DE61CE617A6B422DB7FA8E6CA4D46FF8BFFED32BC79D1B3D9CB2315A9D2DF3440E0D83E7DDAE0C6BFC1CBCEE32B6D074355ED130F67B9E98A4977E490EED32B5B0347C649F3DFFDC7746A974820E7FDAD1028988E193AA243B1152B04B3CF85ECE8468E147972B963D0AF754680D0D1EC68A727D532FE4BA938C62FF671DB261C5E9BFCF9EDAD28CD2C8993EF416A97BD84A1CF598C86A1806A96C60FB24C8CA5F203AFEB29BAA9BAB91381480DF8D4A946CE307F96B74FD14F193


- Файл сертификата certificate-out.pem (VTS_IAPI_OUT_ISS_PUB) должен быть отправлен в VISA как Inbound signature to Visa (self-signed X.509 certificate)
+ Регистрация ключа VTS_IAPI_OUT_ISS_PRIV в веб интерфейсе FT








